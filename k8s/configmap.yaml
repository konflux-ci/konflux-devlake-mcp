---
apiVersion: v1
kind: ConfigMap
metadata:
  name: konflux-mcp-config
  namespace: konflux-devlake
  labels:
    app.kubernetes.io/instance: devlake
    app.kubernetes.io/name: devlake
    devlakeComponent: ui
data:
  # Database configuration - pointing to existing DevLake MySQL
  DB_HOST: "devlake-mysql"
  DB_PORT: "3306"
  DB_DATABASE: "lake"

  # Connection pool configuration for multi-user concurrent access
  # Adjust based on expected concurrent users and MySQL max_connections
  DB_POOL_MIN_SIZE: "5"
  DB_POOL_MAX_SIZE: "50"
  DB_POOL_RECYCLE: "300"

  # Server configuration
  SERVER_HOST: "0.0.0.0"
  SERVER_PORT: "3000"
  SERVER_TRANSPORT: "http"

  # Logging configuration
  LOG_LEVEL: "INFO"

  # OIDC Authentication (Red Hat SSO / Keycloak)
  # Set OIDC_ENABLED to "true" to enable authentication
  OIDC_ENABLED: "false"
  # Example: https://sso.example.com/auth/realms/your-realm
  OIDC_ISSUER_URL: ""
  # The OIDC client ID configured in Red Hat SSO
  OIDC_CLIENT_ID: ""
  # Comma-separated list of required scopes (optional)
  OIDC_REQUIRED_SCOPES: ""
  # JWKS cache TTL in seconds (default: 3600)
  OIDC_JWKS_CACHE_TTL: "3600"
  # Comma-separated list of paths to skip authentication
  OIDC_SKIP_PATHS: "/health,/security"
  # Whether to verify SSL certificates (set to "false" for self-signed certs)
  OIDC_VERIFY_SSL: "true"

  # Offline Token Support (for tokens that don't expire)
  # When enabled, users can authenticate with offline/refresh tokens
  # The server will automatically exchange them for access tokens
  OIDC_OFFLINE_TOKEN_ENABLED: "false"
  # Client ID to use for token exchange (defaults to OIDC_CLIENT_ID if empty)
  OIDC_TOKEN_EXCHANGE_CLIENT_ID: ""
  # Seconds before access token expiry to refresh (default: 60)
  OIDC_ACCESS_TOKEN_CACHE_BUFFER: "60"
